# Quick Reference - Enhanced IndexedDB System\n\n## File Locations\n\n```\nC:\\Projects\\Ezistra\\utils\\db\\\n├── base.repository.ts          ← Base class (14 shared methods)\n├── errors.ts                   ← Error types\n├── index.table.ts              ← DB init with 9 stores + indexes\n├── migrations.ts               ← Schema versioning\n├── index.ts                    ← Central exports & DatabaseService\n├── users.table.ts              ← Users repository\n├── documents.table.ts          ← Documents repository\n├── address_info.table.ts       ← Address repository\n├── university_info.table.ts    ← University repository\n├── higher_education.table.ts   ← Higher education repository\n├── complementary_info.table.ts ← Complementary repository\n├── baccalaureat_info.table.ts  ← Baccalaureat repository\n├── personal_info.table.ts      ← Personal info repository\n├── README.md                   ← Full documentation\n└── QUICK_REFERENCE.md          ← This file\n```\n\n## Import Options\n\n### Option 1: Use DatabaseService (Recommended)\n```typescript\nimport DatabaseService from \"@/utils/db\";\n\nconst repos = DatabaseService.getAllRepositories();\n```\n\n### Option 2: Import specific repositories\n```typescript\nimport { Users, Documents, Address } from \"@/utils/db\";\n\nconst usersRepo = new Users();\nconst docsRepo = new Documents();\n```\n\n## Base Repository Methods (All 14)\n\n### Create\n- `add(data)` → `Promise<string | number | undefined>`\n- `addMany(data[])` → `Promise<(string | number | undefined)[]>`\n\n### Read\n- `getAll()` → `Promise<T[]>`\n- `getById(id)` → `Promise<T | undefined>`\n- `findByIndex(indexName, value)` → `Promise<T[]>`\n- `filter(predicate)` → `Promise<T[]>`\n- `findOne(predicate)` → `Promise<T | undefined>`\n\n### Update\n- `update(id, updates)` → `Promise<boolean>`\n\n### Delete\n- `delete(id)` → `Promise<boolean>`\n- `deleteMany(ids[])` → `Promise<number>`\n\n### Utility\n- `count()` → `Promise<number>`\n- `clear()` → `Promise<boolean>`\n\n## Custom Repository Methods\n\n### Users Repository\n```typescript\nfindByCNE(cne)              // By identity number\nfindByCIN(cin)              // By card number\nfindByEmail(email)          // By email\nsearchByName(name)          // French or Arabic\nfindByGender(\"M\" | \"F\")    // By gender\nfindWithHandicap()          // Students with handicap\n```\n\n### Documents Repository\n```typescript\ngetByStudentId(studentId)   // All documents for student\ngetByType(type)             // Documents of specific type\ngetByStudentIdAndType(studentId, type)  // Combined filter\nsearchByFileName(fileName)  // Search by file name\n```\n\n### Address Repository\n```typescript\ngetByStudentId(studentId)   // All addresses for student\ngetStudentAddresses(studentId)  // Only student addresses\ngetParentAddresses(studentId)   // Only parent addresses\nfindByEmail(email)          // Find by email\n```\n\n### University Repository\n```typescript\ngetByStudentId(studentId)   // University records for student\ngetByAcademicYear(year)     // Records for academic year\ngetCurrentYearInfo(studentId)  // Current year only\n```\n\n### HigherEducation Repository\n```typescript\ngetByStudentId(studentId)   // All higher ed records\ngetByLevel(level)           // By level (bac+2, bac+3, bac+5)\ngetByStudentIdAndLevel(studentId, level)  // Combined\n```\n\n### Complementary Repository\n```typescript\ngetByStudentId(studentId)   // Complementary info for student\ngetByStatus(status)         // By student status\ngetActiveStudents()         // Active students (inscrit)\ngetAlumni()                 // Alumni (ancien étudiant)\n```\n\n### Baccalaureat Repository\n```typescript\ngetByStudentId(studentId)   // Bac records for student\ngetByYear(year)             // Records from specific year\ngetByType(bacType)          // By type (scientifique, lettres, etc.)\ngetHighPerformers()         // Grade >= 16\n```\n\n### PersonalInfoRepository\n```typescript\nfindByCNE(cne)              // By identity number\nfindByCIN(cin)              // By card number\nsearchByName(name)          // French or Arabic name\n```\n\n## Stores & Indexes\n\n| Store | Indexes |\n|-------|----------|\n| users | cne, cin, email |\n| documents | studentId, type |\n| university | studentId, academicYear |\n| higher_education | studentId, level |\n| complementary | studentId, studentStatus |\n| address | studentId, type, email |\n| baccalaureat | studentId, year |\n| personal_info | cne, cin |\n| university_info | studentId, academicYear |\n\n## Common Operations\n\n### Add a record\n```typescript\nconst id = await repos.users.add(userData);\n```\n\n### Update a record\n```typescript\nawait repos.users.update(userId, { firstName: \"John\" });\n```\n\n### Delete a record\n```typescript\nawait repos.users.delete(userId);\n```\n\n### Find by indexed field (FAST)\n```typescript\nconst user = await repos.users.findByCNE(\"AB123456\");\n```\n\n### Find with filter (slower)\n```typescript\nconst users = await repos.users.filter(u => u.gender === \"M\");\n```\n\n### Batch operations\n```typescript\nconst ids = await repos.users.addMany([user1, user2, user3]);\nconst deleted = await repos.users.deleteMany([id1, id2, id3]);\n```\n\n### Count records\n```typescript\nconst total = await repos.users.count();\n```\n\n### Clear store\n```typescript\nawait repos.users.clear();\n```\n\n## Error Handling\n\n```typescript\nimport { NotFoundError, ValidationError, OperationError } from \"@/utils/db\";\n\ntry {\n  await repos.users.update(id, data);\n} catch (error) {\n  if (error instanceof NotFoundError) {\n    // Record doesn't exist\n  } else if (error instanceof ValidationError) {\n    // Invalid data\n  } else if (error instanceof OperationError) {\n    // Database operation failed\n  }\n}\n```\n\n## Performance Tips\n\n1. **Use indexed queries** when possible\n   - `findByCNE()` → Fast (indexed)\n   - `filter(u => u.cne === \"...\")` → Slow (full scan)\n\n2. **Batch operations** for bulk work\n   - `addMany()` → Fast\n   - Loop with `add()` → Slow\n\n3. **Use specific methods** instead of filtering\n   - `getByStudentId(id)` → Indexed, fast\n   - `filter(doc => doc.studentId === id)` → Full scan\n\n4. **Limit result sets**\n   - Query once, filter in code\n   - Don't call query multiple times\n\n## Adding New Migrations\n\n```typescript\n// In utils/db/migrations.ts\nexport const migrations: Migration[] = [\n  // ... existing migrations\n  {\n    version: 2,\n    description: \"Add new index or store\",\n    upgrade: async (db) => {\n      // Migration logic here\n    }\n  }\n];\n```\n\n## Advanced: Custom Repository Methods\n\n```typescript\nexport class Users extends BaseRepository<PersonalInfo> {\n  storeName = \"users\";\n  \n  // Add custom domain-specific methods\n  async findActiveStudents(): Promise<PersonalInfo[]> {\n    return this.filter(user => user.handicap === false);\n  }\n  \n  async getByProvince(province: string): Promise<PersonalInfo[]> {\n    return this.filter(user => user.birthProvince === province);\n  }\n}\n```\n\n## Troubleshooting\n\n**Query returns no results**\n- Check that index exists for the field\n- Verify data was actually added\n- Use `getAll()` to see all records\n\n**Performance is slow**\n- Use indexed fields when possible\n- Check browser DevTools → IndexedDB\n- Consider using `filter()` for complex predicates\n\n**Error handling not working**\n- Import the specific error type\n- Use `instanceof` to check error type\n- Check error.code property\n\n## Full Documentation\n\nFor complete API reference and examples, see `utils/db/README.md`\n"